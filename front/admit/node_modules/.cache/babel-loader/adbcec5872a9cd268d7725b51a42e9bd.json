{"remainingRequest":"D:\\xieyu\\2022-5-22\\admit\\node_modules\\_babel-loader@8.2.5@babel-loader\\lib\\index.js!D:\\xieyu\\2022-5-22\\admit\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js??ref--1-0!D:\\xieyu\\2022-5-22\\admit\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js??vue-loader-options!D:\\xieyu\\2022-5-22\\admit\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\xieyu\\2022-5-22\\admit\\src\\components\\common\\FileUpload.vue","mtime":1651118827311},{"path":"D:\\xieyu\\2022-5-22\\admit\\babel.config.js","mtime":1646893510000},{"path":"D:\\xieyu\\2022-5-22\\admit\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\xieyu\\2022-5-22\\admit\\node_modules\\_babel-loader@8.2.5@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\xieyu\\2022-5-22\\admit\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\xieyu\\2022-5-22\\admit\\node_modules\\_vue-loader@15.9.8@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgc3RvcmFnZSBmcm9tICJAL3V0aWxzL3N0b3JhZ2UiOwppbXBvcnQgYmFzZSBmcm9tICJAL3V0aWxzL2Jhc2UiOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8vIOafpeeci+Wkp+WbvgogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgLy8g5p+l55yL5aSn5Zu+CiAgICAgIGRpYWxvZ0ltYWdlVXJsOiAiIiwKICAgICAgLy8g57uE5Lu25riy5p+T5Zu+54mH55qE5pWw57uE5a2X5q6177yM5pyJ54m55q6K5qC85byP6KaB5rGCCiAgICAgIGZpbGVMaXN0OiBbXSwKICAgICAgZmlsZVVybExpc3Q6IFtdLAogICAgICBteUhlYWRlcnM6IHt9CiAgICB9OwogIH0sCiAgcHJvcHM6IFsidGlwIiwgImFjdGlvbiIsICJsaW1pdCIsICJtdWx0aXBsZSIsICJmaWxlVXJscyJdLAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICAgIHRoaXMubXlIZWFkZXJzID0gewogICAgICBUb2tlbjogc3RvcmFnZS5nZXQoIlRva2VuIikKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgZmlsZVVybHM6IGZ1bmN0aW9uIGZpbGVVcmxzKHZhbCwgb2xkVmFsKSB7CiAgICAgIC8vICAgY29uc29sZS5sb2coIm5ldzogJXMsIG9sZDogJXMiLCB2YWwsIG9sZFZhbCk7CiAgICAgIHRoaXMuaW5pdCgpOwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8vIOiuoeeul+WxnuaAp+eahCBnZXR0ZXIKICAgIGdldEFjdGlvblVybDogZnVuY3Rpb24gZ2V0QWN0aW9uVXJsKCkgewogICAgICAvLyByZXR1cm4gYmFzZS51cmwgKyB0aGlzLmFjdGlvbiArICI/dG9rZW49IiArIHN0b3JhZ2UuZ2V0KCJ0b2tlbiIpOwogICAgICByZXR1cm4gIi8iLmNvbmNhdCh0aGlzLiRiYXNlLm5hbWUsICIvIikgKyB0aGlzLmFjdGlvbjsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGNsZWFyRmlsZXM6IGZ1bmN0aW9uIGNsZWFyRmlsZXMoKSB7CiAgICAgIHRoaXMuJHJlZnMudXBsb2FkLmNsZWFyRmlsZXMoKTsKICAgICAgdGhpcy5maWxlTGlzdCA9IFtdOwogICAgfSwKICAgIC8vIOWIneWni+WMlgogICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgLy8gICBjb25zb2xlLmxvZyh0aGlzLmZpbGVVcmxzKTsKICAgICAgaWYgKHRoaXMuZmlsZVVybHMpIHsKICAgICAgICB0aGlzLmZpbGVVcmxMaXN0ID0gdGhpcy5maWxlVXJscy5zcGxpdCgiLCIpOwogICAgICAgIHZhciBmaWxlQXJyYXkgPSBbXTsKICAgICAgICB0aGlzLmZpbGVVcmxMaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICB2YXIgdXJsID0gaXRlbTsKICAgICAgICAgIHZhciBuYW1lID0gaW5kZXg7CiAgICAgICAgICB2YXIgZmlsZSA9IHsKICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgdXJsOiB1cmwKICAgICAgICAgIH07CiAgICAgICAgICBmaWxlQXJyYXkucHVzaChmaWxlKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnNldEZpbGVMaXN0KGZpbGVBcnJheSk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVCZWZvcmVVcGxvYWQ6IGZ1bmN0aW9uIGhhbmRsZUJlZm9yZVVwbG9hZChmaWxlKSB7fSwKICAgIC8vIOS4iuS8oOaWh+S7tuaIkOWKn+WQjuaJp+ihjAogICAgaGFuZGxlVXBsb2FkU3VjY2VzczogZnVuY3Rpb24gaGFuZGxlVXBsb2FkU3VjY2VzcyhyZXMsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIGlmIChyZXMgJiYgcmVzLmNvZGUgPT09IDApIHsKICAgICAgICBmaWxlTGlzdFtmaWxlTGlzdC5sZW5ndGggLSAxXVsidXJsIl0gPSAidXBsb2FkLyIgKyBmaWxlLnJlc3BvbnNlLmZpbGU7CiAgICAgICAgdGhpcy5zZXRGaWxlTGlzdChmaWxlTGlzdCk7CiAgICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgdGhpcy5maWxlVXJsTGlzdC5qb2luKCIsIikpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDlm77niYfkuIrkvKDlpLHotKUKICAgIGhhbmRsZVVwbG9hZEVycjogZnVuY3Rpb24gaGFuZGxlVXBsb2FkRXJyKGVyciwgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5paH5Lu25LiK5Lyg5aSx6LSlIik7CiAgICB9LAogICAgLy8g56e76Zmk5Zu+54mHCiAgICBoYW5kbGVSZW1vdmU6IGZ1bmN0aW9uIGhhbmRsZVJlbW92ZShmaWxlLCBmaWxlTGlzdCkgewogICAgICB0aGlzLnNldEZpbGVMaXN0KGZpbGVMaXN0KTsKICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgdGhpcy5maWxlVXJsTGlzdC5qb2luKCIsIikpOwogICAgfSwKICAgIC8vIOafpeeci+Wkp+WbvgogICAgaGFuZGxlVXBsb2FkUHJldmlldzogZnVuY3Rpb24gaGFuZGxlVXBsb2FkUHJldmlldyhmaWxlKSB7CiAgICAgIHRoaXMuZGlhbG9nSW1hZ2VVcmwgPSBmaWxlLnVybDsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgIH0sCiAgICAvLyDpmZDliLblm77niYfmlbDph48KICAgIGhhbmRsZUV4Y2VlZDogZnVuY3Rpb24gaGFuZGxlRXhjZWVkKGZpbGVzLCBmaWxlTGlzdCkgewogICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoIlx1NjcwMFx1NTkxQVx1NEUwQVx1NEYyMCIuY29uY2F0KHRoaXMubGltaXQsICJcdTVGMjBcdTU2RkVcdTcyNDciKSk7CiAgICB9LAogICAgLy8g6YeN5paw5a+5ZmlsZUxpc3Tov5vooYzotYvlgLwKICAgIHNldEZpbGVMaXN0OiBmdW5jdGlvbiBzZXRGaWxlTGlzdChmaWxlTGlzdCkgewogICAgICB2YXIgZmlsZUFycmF5ID0gW107CiAgICAgIHZhciBmaWxlVXJsQXJyYXkgPSBbXTsgLy8g5pyJ5Lqb5Zu+54mH5LiN5piv5YWs5byA55qE77yM5omA5Lul6ZyA6KaB5pC65bimdG9rZW7kv6Hmga/lgZrmnYPpmZDmoKHpqowKCiAgICAgIHZhciB0b2tlbiA9IHN0b3JhZ2UuZ2V0KCJ0b2tlbiIpOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGZpbGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgdmFyIHVybCA9IGl0ZW0udXJsLnNwbGl0KCI/IilbMF07CgogICAgICAgIGlmICghdXJsLnN0YXJ0c1dpdGgoImh0dHAiKSkgewogICAgICAgICAgdXJsID0gX3RoaXMuJGJhc2UudXJsICsgdXJsOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5hbWUgPSBpdGVtLm5hbWU7CiAgICAgICAgdmFyIGZpbGUgPSB7CiAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgdXJsOiB1cmwgKyAiP3Rva2VuPSIgKyB0b2tlbgogICAgICAgIH07CiAgICAgICAgZmlsZUFycmF5LnB1c2goZmlsZSk7CiAgICAgICAgZmlsZVVybEFycmF5LnB1c2godXJsKTsKICAgICAgfSk7CiAgICAgIHRoaXMuZmlsZUxpc3QgPSBmaWxlQXJyYXk7CiAgICAgIHRoaXMuZmlsZVVybExpc3QgPSBmaWxlVXJsQXJyYXk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;EACAA,IADA,kBACA;IACA;MACA;MACAC,oBAFA;MAGA;MACAC,kBAJA;MAKA;MACAC,YANA;MAOAC,eAPA;MAQAC;IARA;EAUA,CAZA;EAaAC,yDAbA;EAcAC,OAdA,qBAcA;IACA;IACA;MACAC;IADA;EAGA,CAnBA;EAoBAC;IACAC;MACA;MACA;IACA;EAJA,CApBA;EA0BAC;IACA;IACAC;MACA;MACA;IACA;EALA,CA1BA;EAiCAC;IACAC,UADA,wBACA;MACA;MACA;IACA,CAJA;IAKA;IACAC,IANA,kBAMA;MACA;MACA;QACA;QACA;QACA;UACA;UACA;UACA;YACAC,UADA;YAEAC;UAFA;UAIAC;QACA,CARA;QASA;MACA;IACA,CAtBA;IAuBAC,kBAvBA,8BAuBAC,IAvBA,EAuBA,EAvBA;IAwBA;IACAC,mBAzBA,+BAyBAC,GAzBA,EAyBAF,IAzBA,EAyBAjB,QAzBA,EAyBA;MACA;QACAA;QACA;QACA;MACA,CAJA,MAIA;QACA;MACA;IACA,CAjCA;IAkCA;IACAoB,eAnCA,2BAmCAC,GAnCA,EAmCAJ,IAnCA,EAmCAjB,QAnCA,EAmCA;MACA;IACA,CArCA;IAsCA;IACAsB,YAvCA,wBAuCAL,IAvCA,EAuCAjB,QAvCA,EAuCA;MACA;MACA;IACA,CA1CA;IA2CA;IACAuB,mBA5CA,+BA4CAN,IA5CA,EA4CA;MACA;MACA;IACA,CA/CA;IAgDA;IACAO,YAjDA,wBAiDAC,KAjDA,EAiDAzB,QAjDA,EAiDA;MACA;IACA,CAnDA;IAoDA;IACA0B,WArDA,uBAqDA1B,QArDA,EAqDA;MACA;MACA,sBAFA,CAGA;;MACA;;MACA;;MACAA;QACA;;QACA;UACAc;QACA;;QACA;QACA;UACAD,UADA;UAEAC;QAFA;QAIAC;QACAY;MACA,CAZA;MAaA;MACA;IACA;EA1EA;AAjCA","names":["data","dialogVisible","dialogImageUrl","fileList","fileUrlList","myHeaders","props","mounted","Token","watch","fileUrls","computed","getActionUrl","methods","clearFiles","init","name","url","fileArray","handleBeforeUpload","file","handleUploadSuccess","res","handleUploadErr","err","handleRemove","handleUploadPreview","handleExceed","files","setFileList","fileUrlArray"],"sourceRoot":"src/components/common","sources":["FileUpload.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 上传文件组件 -->\r\n    <el-upload\r\n      ref=\"upload\"\r\n      :action=\"getActionUrl\"\r\n      list-type=\"picture-card\"\r\n      :multiple=\"multiple\"\r\n      :limit=\"limit\"\r\n      :headers=\"myHeaders\"\r\n      :file-list=\"fileList\"\r\n      :on-exceed=\"handleExceed\"\r\n      :on-preview=\"handleUploadPreview\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleUploadSuccess\"\r\n      :on-error=\"handleUploadErr\"\r\n      :before-upload=\"handleBeforeUpload\"\r\n    >\r\n      <i class=\"el-icon-plus\"></i>\r\n      <div slot=\"tip\" class=\"el-upload__tip\" style=\"color: #838fa1\">\r\n        {{ tip }}\r\n      </div>\r\n    </el-upload>\r\n    <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\" append-to-body>\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt />\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport storage from \"@/utils/storage\";\r\nimport base from \"@/utils/base\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 查看大图\r\n      dialogVisible: false,\r\n      // 查看大图\r\n      dialogImageUrl: \"\",\r\n      // 组件渲染图片的数组字段，有特殊格式要求\r\n      fileList: [],\r\n      fileUrlList: [],\r\n      myHeaders: {},\r\n    };\r\n  },\r\n  props: [\"tip\", \"action\", \"limit\", \"multiple\", \"fileUrls\"],\r\n  mounted() {\r\n    this.init();\r\n    this.myHeaders = {\r\n      Token: storage.get(\"Token\"),\r\n    };\r\n  },\r\n  watch: {\r\n    fileUrls: function (val, oldVal) {\r\n      //   console.log(\"new: %s, old: %s\", val, oldVal);\r\n      this.init();\r\n    },\r\n  },\r\n  computed: {\r\n    // 计算属性的 getter\r\n    getActionUrl: function () {\r\n      // return base.url + this.action + \"?token=\" + storage.get(\"token\");\r\n      return `/${this.$base.name}/` + this.action;\r\n    },\r\n  },\r\n  methods: {\r\n    clearFiles() {\r\n      this.$refs.upload.clearFiles();\r\n      this.fileList = []\r\n    },\r\n    // 初始化\r\n    init() {\r\n      //   console.log(this.fileUrls);\r\n      if (this.fileUrls) {\r\n        this.fileUrlList = this.fileUrls.split(\",\");\r\n        let fileArray = [];\r\n        this.fileUrlList.forEach(function (item, index) {\r\n          var url = item;\r\n          var name = index;\r\n          var file = {\r\n            name: name,\r\n            url: url,\r\n          };\r\n          fileArray.push(file);\r\n        });\r\n        this.setFileList(fileArray);\r\n      }\r\n    },\r\n    handleBeforeUpload(file) {},\r\n    // 上传文件成功后执行\r\n    handleUploadSuccess(res, file, fileList) {\r\n      if (res && res.code === 0) {\r\n        fileList[fileList.length - 1][\"url\"] = \"upload/\" + file.response.file;\r\n        this.setFileList(fileList);\r\n        this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n      } else {\r\n        this.$message.error(res.msg);\r\n      }\r\n    },\r\n    // 图片上传失败\r\n    handleUploadErr(err, file, fileList) {\r\n      this.$message.error(\"文件上传失败\");\r\n    },\r\n    // 移除图片\r\n    handleRemove(file, fileList) {\r\n      this.setFileList(fileList);\r\n      this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n    },\r\n    // 查看大图\r\n    handleUploadPreview(file) {\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogVisible = true;\r\n    },\r\n    // 限制图片数量\r\n    handleExceed(files, fileList) {\r\n      this.$message.warning(`最多上传${this.limit}张图片`);\r\n    },\r\n    // 重新对fileList进行赋值\r\n    setFileList(fileList) {\r\n      var fileArray = [];\r\n      var fileUrlArray = [];\r\n      // 有些图片不是公开的，所以需要携带token信息做权限校验\r\n      var token = storage.get(\"token\");\r\n      let _this = this;\r\n      fileList.forEach(function (item, index) {\r\n        var url = item.url.split(\"?\")[0];\r\n        if (!url.startsWith(\"http\")) {\r\n          url = _this.$base.url + url;\r\n        }\r\n        var name = item.name;\r\n        var file = {\r\n          name: name,\r\n          url: url + \"?token=\" + token,\r\n        };\r\n        fileArray.push(file);\r\n        fileUrlArray.push(url);\r\n      });\r\n      this.fileList = fileArray;\r\n      this.fileUrlList = fileUrlArray;\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n</style>\r\n"]}]}